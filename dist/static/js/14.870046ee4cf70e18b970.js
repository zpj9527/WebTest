webpackJsonp([14],{"/ZA0":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("mvHQ"),i=r.n(a),o=r("mtWM"),n=r.n(o),s={name:"saleRules",data:function(){return{outerVisible:!1,CardLevelList:[{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0},{code:"code",descript:"descript",descript_en:"descript_en",is_halt:0}],SelectUrLHeader:this.api.api_pro_dev+"/",UrLHeader:this.api.api_pro_dev+"/v1/",rateHeader:this.api.api_pro_dev+"/v1/",currentPage:1,pagesize:10,total:0,promotionList:[],sort:"",CertainPromotion:{code_type:"CM",code:" ",descript:" ",descript_en:" ",remark:null,date_begin:" ",date_end:" ",card_type:"",card_level:null,hotel:null,trigger_way:"",target_way:"",target_member:"",target_number:0,point_end_datetime:null,is_only_once:null,is_halt:"0",create_user:"tom"},salesNewadd:!1,CardTypeTree:[],CardLevelTree:[],trigger_wayArr:[{code:"night_audit",descript:"每天夜审时"},{code:"check_in",descript:"客房登记入住时"},{code:"login_in",descript:"协议单位登录时"},{code:"upgrade",descript:"协议单位升级时"},{code:"evaluation",descript:"协议单位网站评价时"},{code:"sing_in",descript:"协议单位网站签到时"},{code:"card_charge",descript:"储值卡充值时"},{code:"room_check_out",descript:"客房结账时"},{code:"register_card",descript:"注册协议单位成功时"}],trigger_wayDic:{night_audit:"每天夜审时",check_in:"客房登记入住时",login_in:"协议单位登录时",upgrade:"协议单位升级时",evaluation:"协议单位网站评价时",sing_in:"协议单位网站签到时",card_charge:"储值卡充值时",room_check_out:"客房结账时",register_card:"注册协议单位成功时"},target_wayArr:[{code:"DP",descript:"点积分"},{code:"TP",descript:"倍积分"},{code:"DM",descript:"点储值"},{code:"TM",descript:"倍储值"}],target_wayDic:{DP:"点积分",TP:"倍积分",DM:"点储值",TM:"倍储值"},target_memberArr:[{code:"self",descript:"本人"},{code:"referrer",descript:"推荐人"}],charge_form:{is_first:!0,min_pay:0,max_pay:0}}},created:function(){this.get_card_type_tree(),this.handleCurrentPageChange(this.currentPage)},methods:{showFunc:function(){this.outerVisible=!this.outerVisible},get_card_promotion_list:function(){this.handleCurrentPageChange(this.currentPage)},get_card_promotion_info:function(e){var t=this,r=t.UrLHeader+"customer/member/get_card_promotion_info/"+e+"/";t.outerVisible=!0,t.salesNewadd=!1,n.a.get(r).then(function(e){for(var r in t.CertainPromotion=e.data.data,t.target_memberArr)t.CertainPromotion.target_member==t.target_memberArr[r].code&&(t.CertainPromotion.target_member=t.target_memberArr[r].descript);for(var a in t.CardTypeTree)if(t.CertainPromotion.card_type==t.CardTypeTree[a].id)for(var i in t.CertainPromotion.card_type=t.CardTypeTree[a].descript,t.CardTypeTree[a].children)t.CertainPromotion.card_level==t.CardTypeTree[a].children[i].id&&(t.CertainPromotion.card_level=t.CardTypeTree[a].children[i].descript);t.CertainPromotion.cond_and_para&&(t.CertainPromotion.cond_and_para=JSON.parse(t.CertainPromotion.cond_and_para),t.CertainPromotion.cond_and_para.is_first?t.charge_form.is_first=!0:t.charge_form.is_first=!1,t.charge_form={is_first:t.charge_form.is_first,min_pay:t.CertainPromotion.cond_and_para.min_pay,max_pay:t.CertainPromotion.cond_and_para.max_pay}),t.CertainPromotion.is_halt?t.CertainPromotion.is_halt="1":t.CertainPromotion.is_halt="0"}).catch(function(e){console.info(e)})},NewAddRules:function(){this.showFunc(),this.salesNewadd=!0,this.CertainPromotion={code_type:"CM",code:" ",descript:" ",descript_en:" ",remark:null,date_begin:new Date,date_end:new Date,card_type:" ",card_level:" ",hotel:null,trigger_way:"",target_way:"",target_member:"",target_number:0,point_end_datetime:null,is_only_once:null,is_halt:"0",create_user:"tom"}},add_card_base:function(){var e=this,t=this.UrLHeader+"customer/member/add_card_promotion/",r=void 0;r=e.charge_form.is_first?1:0,"card_charge"==e.CertainPromotion.trigger_way&&(e.CertainPromotion.cond_and_para=e.charge_form,e.CertainPromotion.cond_and_para.is_first=r,e.CertainPromotion.cond_and_para.min_pay=parseFloat(e.CertainPromotion.cond_and_para.min_pay),e.CertainPromotion.cond_and_para.max_pay=parseFloat(e.CertainPromotion.cond_and_para.max_pay),e.CertainPromotion.cond_and_para=i()(e.CertainPromotion.cond_and_para)),n.a.post(t,e.CertainPromotion).then(function(t){"success"==t.data.message?(e.showFunc(),e.$message({message:"保存成功",type:"success"}),e.handleCurrentPageChange(e.currentPage)):e.$message.error("保存信息失败")}).catch(function(e){})},update_card_promotion_info:function(e){var t=this,r=this.UrLHeader+"customer/member/update_card_promotion/"+e+"/";for(var a in t.target_memberArr)t.CertainPromotion.target_member==t.target_memberArr[a].descript&&(t.CertainPromotion.target_member=t.target_memberArr[a].id);for(var o in t.CardTypeTree)if(t.CertainPromotion.card_type==t.CardTypeTree[o].descript)for(var s in t.CertainPromotion.card_type=t.CardTypeTree[o].id,t.CardTypeTree[o].children)t.CertainPromotion.card_level==t.CardTypeTree[o].children[s].descript&&(t.CertainPromotion.card_level=t.CardTypeTree[o].children[s].id);var c=void 0;c=t.charge_form.is_first?1:0,"card_charge"==t.CertainPromotion.trigger_way&&(t.CertainPromotion.cond_and_para=t.charge_form,t.CertainPromotion.cond_and_para.is_first=c,t.CertainPromotion.cond_and_para.min_pay=parseFloat(t.CertainPromotion.cond_and_para.min_pay),t.CertainPromotion.cond_and_para.max_pay=parseFloat(t.CertainPromotion.cond_and_para.max_pay),t.CertainPromotion.cond_and_para=i()(t.CertainPromotion.cond_and_para)),console.log(t.CertainPromotion),t.CertainPromotion.code&&t.CertainPromotion.descript&&t.CertainPromotion.descript_en&&t.CertainPromotion.date_begin&&t.CertainPromotion.date_end&&t.CertainPromotion.card_type&&t.CertainPromotion.card_level?n.a.post(r,t.CertainPromotion).then(function(e){"success"==e.data.message?(t.$message({message:"保存成功",type:"success"}),t.handleCurrentPageChange(t.currentPage),t.get_card_promotion_info(t.CertainPromotion.id)):this.$message.error("保存信息失败")}).catch(function(e){}):t.$message.error("带*项不能为空")},remove_card_promotion_info:function(e){var t=this.UrLHeader+"customer/member/remove_card_promotion/"+e+"/",r=this;r.$confirm("是否永久该删除促销规则?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){n.a.post(t).then(function(e){"success"==e.data.message?(r.showFunc(),r.handleCurrentPageChange(r.currentPage),r.$message({message:"删除成功",type:"success"})):this.$message.error("保存信息失败")}).catch(function(e){})}).catch(function(){r.$message({type:"info",message:"已取消删除"})})},handleCurrentPageChange:function(e){var t=this,r=t.UrLHeader+"customer/member/get_card_promotion_list/?code_type=CM";n()({method:"get",url:r,params:{page:e,page_size:10}}).then(function(e){for(var r in t.promotionList=e.data.data.results,t.total=e.data.data.count,t.promotionList){for(var a in t.target_memberArr)t.promotionList[r].target_member==t.target_memberArr[a].code&&(t.promotionList[r].target_member=t.target_memberArr[a].descript);for(var i in t.CardTypeTree)if(t.promotionList[r].card_type==t.CardTypeTree[i].id)for(var o in t.promotionList[r].card_type=t.CardTypeTree[i].descript,t.CardTypeTree[i].children)t.promotionList[r].card_level==t.CardTypeTree[i].children[o].id&&(t.promotionList[r].card_level=t.CardTypeTree[i].children[o].descript)}}).catch(function(e){_this.$message.error("获取信息失败")})},get_card_type_tree:function(){var e=this.UrLHeader+"customer/member/get_card_setting_tree/?code_type=CM",t=this;n.a.get(e).then(function(e){"success"==e.data.message?t.CardTypeTree=e.data.data.results:t.$message.error("请求服务器失败，稍后重试")}).catch(function(e){})},get_card_level_tree:function(){if(this.CardTypeTree.length)for(var e in this.CardTypeTree)this.CertainPromotion.card_type==this.CardTypeTree[e].id&&(this.CardLevelTree=this.CardTypeTree[e].children);else this.$message({message:"请先选择协议单位计划",type:"warning"})},isnull:function(e){var t=e.replace(/(^\s*)|(\s*$)/g,"");return console.log(e),""==t||void 0==t||null==t}}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"saleRules"},[r("div",{staticClass:"btn-group"},[r("div",{staticClass:"single-btn",on:{click:function(t){e.NewAddRules()}}},[e._v("新增")])]),e._v(" "),r("div",{staticClass:"table"},[r("table",{staticStyle:{width:"100%"}},[e._m(0),e._v(" "),r("tbody",e._l(e.promotionList,function(t,a){return r("tr",{key:a,on:{click:function(r){e.get_card_promotion_info(t.id)}}},[r("td",[e._v(e._s(a+1))]),e._v(" "),r("td",[e._v(e._s(t.code))]),e._v(" "),r("td",[e._v(e._s(t.descript))]),e._v(" "),r("td",[e._v(e._s(t.date_begin))]),e._v(" "),r("td",[e._v(e._s(t.date_end))]),e._v(" "),r("td",[e._v(e._s(t.card_type))]),e._v(" "),r("td",[e._v(e._s(t.card_level))]),e._v(" "),r("td",[e._v(e._s(e.trigger_wayDic[t.trigger_way]))]),e._v(" "),r("td",[e._v(e._s(e.target_wayDic[t.target_way]))]),e._v(" "),r("td",[e._v(e._s(t.target_number))]),e._v(" "),r("td",[t.is_halt?r("p",[e._v("是")]):r("p",[e._v("否")])]),e._v(" "),r("td",[e._v(e._s(t.target_member))]),e._v(" "),r("td",[e._v(e._s(t.modify_user))]),e._v(" "),r("td",[e._v(e._s(t.modify_datetime))])])}),0)]),e._v(" "),0==e.total?r("p",{staticStyle:{padding:"20px 0","text-align":"center"}},[e._v("当前暂无数据")]):e._e(),e._v(" "),r("div",{staticClass:"pagination"},[r("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pagesize,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentPageChange}})],1)]),e._v(" "),r("el-dialog",{attrs:{title:"促销规则定义",visible:e.outerVisible},on:{"update:visible":function(t){e.outerVisible=t}}},[r("div",{staticClass:"outdialog"},[r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("代码："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请输入内容",maxlength:"10"},model:{value:e.CertainPromotion.code,callback:function(t){e.$set(e.CertainPromotion,"code",t)},expression:"CertainPromotion.code"}})],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("停用：")]),e._v(" "),r("el-radio",{attrs:{label:"1"},model:{value:e.CertainPromotion.is_halt,callback:function(t){e.$set(e.CertainPromotion,"is_halt",t)},expression:"CertainPromotion.is_halt"}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:"0"},model:{value:e.CertainPromotion.is_halt,callback:function(t){e.$set(e.CertainPromotion,"is_halt",t)},expression:"CertainPromotion.is_halt"}},[e._v("否")])],1)]),e._v(" "),r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("描述："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请输入内容"},model:{value:e.CertainPromotion.descript,callback:function(t){e.$set(e.CertainPromotion,"descript",t)},expression:"CertainPromotion.descript"}})],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("英文描述："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请输入内容"},model:{value:e.CertainPromotion.descript_en,callback:function(t){e.$set(e.CertainPromotion,"descript_en",t)},expression:"CertainPromotion.descript_en"}})],1)]),e._v(" "),r("div",{staticClass:"innerbox"},[r("p",[e._v("说明： ")]),e._v(" "),r("el-input",{staticStyle:{width:"85.6%","max-height":"100px","vertical-align":"top"},attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.CertainPromotion.remark,callback:function(t){e.$set(e.CertainPromotion,"remark",t)},expression:"CertainPromotion.remark"}})],1),e._v(" "),r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("开始时间："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-date-picker",{staticStyle:{width:"70%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.CertainPromotion.date_begin,callback:function(t){e.$set(e.CertainPromotion,"date_begin",t)},expression:"CertainPromotion.date_begin"}})],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("结束时间："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-date-picker",{staticStyle:{width:"70%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.CertainPromotion.date_end,callback:function(t){e.$set(e.CertainPromotion,"date_end",t)},expression:"CertainPromotion.date_end"}})],1)]),e._v(" "),r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("协议计划："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-select",{staticStyle:{width:"70%"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.CertainPromotion.card_type,callback:function(t){e.$set(e.CertainPromotion,"card_type",t)},expression:"CertainPromotion.card_type"}},e._l(e.CardTypeTree,function(e,t){return r("el-option",{key:t,attrs:{label:e.descript,value:e.id}})}),1)],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("协议等级：")]),e._v(" "),r("el-select",{staticStyle:{width:"70%"},attrs:{filterable:"",placeholder:"请选择"},on:{focus:function(t){e.get_card_level_tree()}},model:{value:e.CertainPromotion.card_level,callback:function(t){e.$set(e.CertainPromotion,"card_level",t)},expression:"CertainPromotion.card_level"}},e._l(e.CardLevelTree,function(e,t){return r("el-option",{key:t,attrs:{label:e.descript,value:e.id}})}),1)],1)]),e._v(" "),r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("适用酒店：")]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请输入内容"},model:{value:e.CertainPromotion.hotel,callback:function(t){e.$set(e.CertainPromotion,"hotel",t)},expression:"CertainPromotion.hotel"}})],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("排序：")]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请输入内容"},model:{value:e.sort,callback:function(t){e.sort=t},expression:"sort"}})],1)]),e._v(" "),r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("触发方式："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-select",{staticStyle:{width:"70%"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.CertainPromotion.trigger_way,callback:function(t){e.$set(e.CertainPromotion,"trigger_way",t)},expression:"CertainPromotion.trigger_way"}},e._l(e.trigger_wayArr,function(e,t){return r("el-option",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("奖励方式："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-select",{staticStyle:{width:"70%"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.CertainPromotion.target_way,callback:function(t){e.$set(e.CertainPromotion,"target_way",t)},expression:"CertainPromotion.target_way"}},e._l(e.target_wayArr,function(e,t){return r("el-option",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1)]),e._v(" "),r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("奖励对象："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-select",{staticStyle:{width:"70%"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.CertainPromotion.target_member,callback:function(t){e.$set(e.CertainPromotion,"target_member",t)},expression:"CertainPromotion.target_member"}},e._l(e.target_memberArr,function(e,t){return r("el-option",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("奖励金额："),r("i",{staticClass:"red"},[e._v("*")])]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请输入内容"},model:{value:e.CertainPromotion.target_number,callback:function(t){e.$set(e.CertainPromotion,"target_number",t)},expression:"CertainPromotion.target_number"}})],1)]),e._v(" "),"card_charge"==e.CertainPromotion.trigger_way?r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("最小充值金额：")]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{type:"number",placeholder:"请输入内容"},model:{value:e.charge_form.min_pay,callback:function(t){e.$set(e.charge_form,"min_pay",t)},expression:" charge_form.min_pay "}})],1),e._v(" "),r("div",{staticClass:"inner pull-right"},[r("p",[e._v("最大充值金额：")]),e._v(" "),r("el-input",{staticStyle:{width:"70%"},attrs:{type:"number",placeholder:"请输入内容"},model:{value:e.charge_form.max_pay,callback:function(t){e.$set(e.charge_form,"max_pay",t)},expression:" charge_form.max_pay "}})],1)]):e._e(),e._v(" "),"card_charge"==e.CertainPromotion.trigger_way?r("div",{staticClass:"innerbox"},[r("div",{staticClass:"inner pull-left"},[r("p",[e._v("是否首次充值：")]),e._v(" "),r("el-checkbox",{model:{value:e.charge_form.is_first,callback:function(t){e.$set(e.charge_form,"is_first",t)},expression:" charge_form.is_first "}})],1)]):e._e(),e._v(" "),e.salesNewadd?r("div",{staticClass:"CancleAndSave pull-right",staticStyle:{margin:"20px 0"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.add_card_base()}}},[e._v("保存")])],1):r("div",{staticClass:"CancleAndSave pull-right",staticStyle:{margin:"20px 0"}},[r("el-button",{staticStyle:{"background-color":"#68819E"},attrs:{type:"primary"},on:{click:function(t){e.remove_card_promotion_info(e.CertainPromotion.id)}}},[e._v("删除")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.update_card_promotion_info(e.CertainPromotion.id)}}},[e._v("保存")])],1)])])],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("thead",[r("tr",[r("th",[e._v("编号")]),e._v(" "),r("th",[e._v("代码")]),e._v(" "),r("th",[e._v("描述")]),e._v(" "),r("th",[e._v("开始日期")]),e._v(" "),r("th",[e._v("结束日期")]),e._v(" "),r("th",[e._v("协议单位计划")]),e._v(" "),r("th",[e._v("协议单位等级")]),e._v(" "),r("th",[e._v("触发方式")]),e._v(" "),r("th",[e._v("奖励方式")]),e._v(" "),r("th",[e._v("奖励")]),e._v(" "),r("th",[e._v("停用")]),e._v(" "),r("th",[e._v("奖励对象")]),e._v(" "),r("th",[e._v("修改用户")]),e._v(" "),r("th",[e._v("修改时间")])])])}]};var d=r("VU/8")(s,c,!1,function(e){r("PT2r")},"data-v-eaad6b88",null);t.default=d.exports},PT2r:function(e,t){}});